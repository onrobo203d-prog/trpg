<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRPGã‚¹ã‚´ãƒ­ã‚¯ - ã‚¹ãƒãƒ›ç‰ˆ</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#f0f0f0; }
#game-container { display:flex; flex-direction:column; height:100vh; }
#map { background:#ccc; flex:1; position:relative; overflow:hidden; }
#player-icon { position:absolute; width:40px; height:40px; background:red; border-radius:50%; transition:left 0.5s, top 0.5s; }
#enemy-icon { position:absolute; width:40px; height:40px; background:purple; border-radius:50%; transition:left 0.5s, top 0.5s; }
#log { background:#fff; height:80px; overflow-y:scroll; padding:5px; font-size:12px; border-top:2px solid #999; border-bottom:2px solid #999; }
#controls { padding:5px; background:#eee; display:flex; flex-wrap:wrap; justify-content:center; }
button { margin:2px; padding:8px 12px; font-size:14px; }
#party { background:#fff; padding:5px; max-height:120px; overflow-y:auto; font-size:12px; }
.party-member { border:1px solid #aaa; background:#eef; margin:2px; padding:2px; display:flex; justify-content:space-between; }
input[type="text"] { width:80px; font-size:12px; }
.dice-roll { font-weight:bold; color:blue; }
</style>
</head>
<body>

<div id="game-container">
  <div id="map">
    <div id="player-icon"></div>
    <div id="enemy-icon" style="display:none;"></div>
  </div>
  <div id="log"></div>
  <div id="controls"></div>
  <div id="party"></div>
</div>

<script>
// ---------------- ãƒ‡ãƒ¼ã‚¿ ----------------
const mapLength = 30;
let pos = 0;
let supportPoints = 0;
let items = [];
const player = {name:"ãƒ©ã‚¤ãƒãƒ¼", hp:100, maxHp:100, attack:50, defense:30, weapon:"", armor:""};
const listeners = [];
for(let i=0;i<5;i++) listeners.push({name:`ãƒªã‚¹ãƒŠãƒ¼${i+1}`, hp:50+Math.floor(Math.random()*20), maxHp:50+Math.floor(Math.random()*20), attack:15+Math.floor(Math.random()*10), weapon:"", armor:"", status:[]});
const boss = {name:"å«‰å¦¬ã®é­”ç‹ã‚¢ãƒ³ãƒã‚¼ãƒ ", hp:5000, attack:50, status:[]};

const weaponList=["å‰£","å¼“","æ–","æ–§"];
const armorList=["é§","ãƒ­ãƒ¼ãƒ–","é©é§","ç›¾"];

const diceResults=[
  {roll:1,effect:"nothing", text:"é™ã‹ãªæ™‚é–“ãŒæµã‚ŒãŸâ€¦"},
  {roll:2,effect:"support", value:1, text:"å¿œæ´ãƒã‚¤ãƒ³ãƒˆ +1"},
  {roll:3,effect:"heal", value:25, text:"ãƒªã‚¹ãƒŠãƒ¼å…¨å“¡HP25%å›å¾©"},
  {roll:4,effect:"heal", value:50, text:"ãƒªã‚¹ãƒŠãƒ¼å…¨å“¡HP50%å›å¾©"},
  {roll:5,effect:"poison", text:"ãƒ©ãƒ³ãƒ€ãƒ ãƒªã‚¹ãƒŠãƒ¼ã«æ¯’ï¼"},
  {roll:6,effect:"item", text:"ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç™ºè¦‹ï¼"}
];

const mapDiv = document.getElementById("map");
const logDiv = document.getElementById("log");
const controlsDiv = document.getElementById("controls");
const partyDiv = document.getElementById("party");
const playerIcon = document.getElementById("player-icon");
const enemyIcon = document.getElementById("enemy-icon");

function log(text){ logDiv.innerHTML+=text+"<br>"; logDiv.scrollTop=logDiv.scrollHeight; }
function updateParty(){
  partyDiv.innerHTML="";
  listeners.forEach((l,i)=>{
    const div = document.createElement("div");
    div.className="party-member";
    div.innerHTML=`<span><input type="text" value="${l.name}" id="name${i}"></span>
      <span>HP:${l.hp}/${l.maxHp} ${l.weapon}/${l.armor}</span>
      <button onclick="removeListener(${i})">å‰Šé™¤</button>`;
    partyDiv.appendChild(div);
  });
  if(listeners.length<10){
    const btn = document.createElement("button"); btn.textContent="ãƒªã‚¹ãƒŠãƒ¼è¿½åŠ "; btn.onclick=addListener; partyDiv.appendChild(btn);
  }
}
function addListener(){ const i=listeners.length; listeners.push({name:`ãƒªã‚¹ãƒŠãƒ¼${i+1}`, hp:50+Math.floor(Math.random()*20), maxHp:50+Math.floor(Math.random()*20), attack:15+Math.floor(Math.random()*10), weapon:"", armor:"", status:[]}); updateParty(); }
function removeListener(i){ listeners.splice(i,1); updateParty(); }
function equipDice(target){ target.weapon=weaponList[Math.floor(Math.random()*weaponList.length)]; target.armor=armorList[Math.floor(Math.random()*armorList.length)]; log(`${target.name}ã®è£…å‚™æ±ºå®š: ${target.weapon}/${target.armor}`); }

// ---------------- åˆæœŸåŒ– ----------------
function startGame(){
  log("ã‚²ãƒ¼ãƒ é–‹å§‹ï¼è£…å‚™ã‚’ãƒ€ã‚¤ã‚¹ã§æ±ºå®šï¼");
  equipDice(player); listeners.forEach(l=>equipDice(l));
  updateParty();
  controlsDiv.innerHTML="";
  addButton("ãƒ‡ãƒ¼ãƒˆã‚³ãƒ¼ã‚¹", ()=>nextMove());
  addButton("ç‰¹è¨“ã‚³ãƒ¼ã‚¹", ()=>nextMove());
}

// ---------------- UI ----------------
function addButton(text, cb){ const btn=document.createElement("button"); btn.textContent=text; btn.onclick=cb; controlsDiv.appendChild(btn); }

// ---------------- ãƒã‚¹é€²è¡Œ ----------------
function nextMove(){
  if(pos>=mapLength){ log("å…¨ãƒã‚¹ã‚¯ãƒªã‚¢ï¼"); return; }
  moveAnimation(()=>diceRoll());
}
function moveAnimation(callback){
  const targetLeft = (pos+1)*10; // ç°¡æ˜“ãƒã‚¹ä½ç½®
  playerIcon.style.left=targetLeft+"px";
  setTimeout(()=>{
    log(`ãƒã‚¹ ${pos+1} ã«åˆ°ç€ï¼`);
    callback();
  }, 600); // ç§»å‹•ã‚¢ãƒ‹ãƒ¡0.6ç§’
}
function diceRoll(){
  const roll = Math.floor(Math.random()*6)+1;
  log(`ğŸ² ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã£ãŸï¼ å‡ºç›®ã¯ <span class="dice-roll">${roll}</span>`);
  const res = diceResults.find(d=>d.roll===roll);
  setTimeout(()=>{
    log(res.text);
    switch(res.effect){
      case "support": supportPoints+=res.value; break;
      case "heal": listeners.forEach(l=>l.hp=Math.min(l.maxHp,l.hp+res.value)); break;
      case "poison": listeners[Math.floor(Math.random()*listeners.length)].status.push("poison"); break;
      case "item": items.push("ã‚¢ã‚¤ãƒ†ãƒ "); break;
    }
    pos++;
    addButton("æ¬¡ã®ãƒã‚¹ã¸", nextMove);
  }, 800); // ãƒ€ã‚¤ã‚¹æ¼”å‡º0.8ç§’
}

// ---------------- æˆ¦é—˜ï¼ˆç°¡æ˜“ï¼‰ ----------------
function battleEvent(){
  enemyIcon.style.display="block";
  log("æ•µã¨é­é‡ï¼æ”»æ’ƒãƒœã‚¿ãƒ³ã§æˆ¦é—˜é–‹å§‹");
  controlsDiv.innerHTML="";
  addButton("æ”»æ’ƒ", ()=>{
    log("æ”»æ’ƒï¼æ•µã«ãƒ€ãƒ¡ãƒ¼ã‚¸");
    enemyIcon.style.display="none";
    pos++;
    addButton("æ¬¡ã®ãƒã‚¹ã¸", nextMove);
  });
}

// ---------------- åˆ†å² ----------------
function branchEvent(){
  log("åˆ†å²ãƒã‚¹ï¼è£…å‚™æ›´æ–°å¯èƒ½");
  controlsDiv.innerHTML="";
  addButton("è£…å‚™æ›´æ–°ï¼†ã‚³ãƒ¼ã‚¹ç§»å‹•", ()=>{
    equipDice(player); listeners.forEach(l=>equipDice(l));
    pos++; nextMove();
  });
  addButton("ãã®ã¾ã¾é€²ã‚€", ()=>{ pos++; nextMove(); });
}

// ---------------- åˆæœŸåŒ–å‘¼ã³å‡ºã— ----------------
startGame();
updateParty();
</script>

</body>
</html>
