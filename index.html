<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRPGã‚¹ã‚´ãƒ­ã‚¯ - ã‚¹ãƒãƒ›æ”¹è‰¯ç‰ˆ</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#f0f0f0; }
#game-container { display:flex; flex-direction:column; height:100vh; }
/* ä¸ŠåŠåˆ†ï¼šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³+ãƒ­ã‚° */
#top-half { flex:1; display:flex; flex-direction:column; }
#map { flex:1; background:#ccc; position:relative; }
#player-icon { position:absolute; width:40px; height:40px; background:red; border-radius:50%; transition:left 0.5s, top 0.5s; }
#enemy-icon { position:absolute; width:40px; height:40px; background:purple; border-radius:50%; transition:left 0.5s, top 0.5s; display:none; }
#log { flex:1; background:#fff; overflow-y:scroll; padding:5px; font-size:12px; border-top:2px solid #999; border-bottom:2px solid #999; }
/* ä¸‹åŠåˆ†ï¼šæ“ä½œ+ãƒªã‚¹ãƒŠãƒ¼ */
#bottom-half { flex:1; display:flex; flex-direction:column; }
#controls { padding:5px; background:#eee; display:flex; flex-wrap:wrap; justify-content:center; }
button { margin:2px; padding:8px 12px; font-size:14px; }
#party { flex:1; background:#fff; padding:5px; overflow-y:auto; font-size:12px; }
.party-member { border:1px solid #aaa; background:#eef; margin:2px; padding:2px; display:flex; justify-content:space-between; }
input[type="text"] { width:80px; font-size:12px; }
.dice-roll { font-weight:bold; color:blue; }
</style>
</head>
<body>

<div id="game-container">
  <div id="top-half">
    <div id="map">
      <div id="player-icon"></div>
      <div id="enemy-icon"></div>
    </div>
    <div id="log"></div>
  </div>
  <div id="bottom-half">
    <div id="controls"></div>
    <div id="party"></div>
  </div>
</div>

<script>
// ---------------- ãƒ‡ãƒ¼ã‚¿ ----------------
const mapLength = 30;
let pos = 0;
let supportPoints = 0;
let items = [];
const player = {name:"ãƒ©ã‚¤ãƒãƒ¼", hp:100, maxHp:100, attack:50, defense:30, weapon:"", armor:""};
const listeners = [];
for(let i=0;i<5;i++) listeners.push({name:`ãƒªã‚¹ãƒŠãƒ¼${i+1}`, hp:50+Math.floor(Math.random()*20), maxHp:50+Math.floor(Math.random()*20), attack:15+Math.floor(Math.random()*10), weapon:"", armor:"", status:[]});
const boss = {name:"å«‰å¦¬ã®é­”ç‹ã‚¢ãƒ³ãƒã‚¼ãƒ ", hp:5000, attack:50, status:[]};

const weaponList=["å‰£","å¼“","æ–","æ–§"];
const armorList=["é§","ãƒ­ãƒ¼ãƒ–","é©é§","ç›¾"];

const diceResults=[
  {roll:1,effect:"nothing", text:"é™ã‹ãªæ™‚é–“ãŒæµã‚ŒãŸâ€¦"},
  {roll:2,effect:"support", value:1, text:"å¿œæ´ãƒã‚¤ãƒ³ãƒˆ +1"},
  {roll:3,effect:"heal", value:25, text:"ãƒªã‚¹ãƒŠãƒ¼å…¨å“¡HP25%å›å¾©"},
  {roll:4,effect:"heal", value:50, text:"ãƒªã‚¹ãƒŠãƒ¼å…¨å“¡HP50%å›å¾©"},
  {roll:5,effect:"poison", text:"ãƒ©ãƒ³ãƒ€ãƒ ãƒªã‚¹ãƒŠãƒ¼ã«æ¯’ï¼"},
  {roll:6,effect:"item", text:"ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç™ºè¦‹ï¼"}
];

const mapDiv = document.getElementById("map");
const logDiv = document.getElementById("log");
const controlsDiv = document.getElementById("controls");
const partyDiv = document.getElementById("party");
const playerIcon = document.getElementById("player-icon");
const enemyIcon = document.getElementById("enemy-icon");

// ---------------- ãƒ­ã‚° ----------------
function log(text){ logDiv.innerHTML+=text+"<br>"; logDiv.scrollTop=logDiv.scrollHeight; }

// ---------------- ãƒ‘ãƒ¼ãƒ†ã‚£ ----------------
function updateParty(){
  partyDiv.innerHTML="";
  listeners.forEach((l,i)=>{
    const div = document.createElement("div");
    div.className="party-member";
    div.innerHTML=`<span><input type="text" value="${l.name}" id="name${i}"></span>
      <span>HP:${l.hp}/${l.maxHp} ${l.weapon}/${l.armor}</span>
      <button onclick="removeListener(${i})">å‰Šé™¤</button>`;
    partyDiv.appendChild(div);
  });
  if(listeners.length<10){
    const btn = document.createElement("button"); btn.textContent="ãƒªã‚¹ãƒŠãƒ¼è¿½åŠ "; btn.onclick=addListener; partyDiv.appendChild(btn);
  }
}
function addListener(){ const i=listeners.length; listeners.push({name:`ãƒªã‚¹ãƒŠãƒ¼${i+1}`, hp:50+Math.floor(Math.random()*20), maxHp:50+Math.floor(Math.random()*20), attack:15+Math.floor(Math.random()*10), weapon:"", armor:"", status:[]}); updateParty(); }
function removeListener(i){ listeners.splice(i,1); updateParty(); }
function equipDice(target){ target.weapon=weaponList[Math.floor(Math.random()*weaponList.length)]; target.armor=armorList[Math.floor(Math.random()*armorList.length)]; log(`${target.name}ã®è£…å‚™æ±ºå®š: ${target.weapon}/${target.armor}`); }

// ---------------- ãƒœã‚¿ãƒ³ç®¡ç† ----------------
function setButtons(buttons){
  controlsDiv.innerHTML=""; // å‰ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªã‚¢
  buttons.forEach(b=>{
    const btn = document.createElement("button");
    btn.textContent = b.text;
    btn.onclick = b.cb;
    controlsDiv.appendChild(btn);
  });
}

// ---------------- ã‚²ãƒ¼ãƒ é–‹å§‹å‰ãƒ•ãƒ­ãƒ¼ ----------------
function startGame(){
  log("ãƒªã‚¹ãƒŠãƒ¼ã‚»ãƒƒãƒˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚");
  updateParty();
  setButtons([
    {text:"ãƒªã‚¹ãƒŠãƒ¼æº–å‚™å®Œäº†", cb:()=>courseSelection()}
  ]);
}

// ---------------- ã‚³ãƒ¼ã‚¹é¸æŠ ----------------
function courseSelection(){
  log("ã‚³ãƒ¼ã‚¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
  setButtons([
    {text:"ãƒ‡ãƒ¼ãƒˆã‚³ãƒ¼ã‚¹", cb:()=>equipAll()},
    {text:"ç‰¹è¨“ã‚³ãƒ¼ã‚¹", cb:()=>equipAll()}
  ]);
}

// ---------------- è£…å‚™ãƒ€ã‚¤ã‚¹ ----------------
function equipAll(){
  log("è£…å‚™ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã‚Šã¾ã™ï¼");
  equipDice(player);
  listeners.forEach(l=>equipDice(l));
  updateParty();
  setButtons([{text:"ã‚¹ã‚¿ãƒ¼ãƒˆ", cb:()=>nextMove()}]);
}

// ---------------- ãƒã‚¹é€²è¡Œ ----------------
function nextMove(){
  if(pos>=mapLength){ log("å…¨ãƒã‚¹ã‚¯ãƒªã‚¢ï¼"); return; }
  moveAnimation(()=>diceRoll());
}
function moveAnimation(callback){
  const targetLeft = (pos+1)*10; // ç°¡æ˜“ãƒã‚¹ä½ç½®
  playerIcon.style.left=targetLeft+"px";
  setTimeout(()=>{
    log(`ãƒã‚¹ ${pos+1} ã«åˆ°ç€ï¼`);
    callback();
  }, 600);
}

// ---------------- ãƒ€ã‚¤ã‚¹ ----------------
function diceRoll(){
  const roll = Math.floor(Math.random()*6)+1;
  log(`ğŸ² ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã£ãŸï¼ å‡ºç›®ã¯ <span class="dice-roll">${roll}</span>`);
  const res = diceResults.find(d=>d.roll===roll);
  setTimeout(()=>{
    log(res.text);
    switch(res.effect){
      case "support": supportPoints+=res.value; break;
      case "heal": listeners.forEach(l=>l.hp=Math.min(l.maxHp,l.hp+res.value)); break;
      case "poison": listeners[Math.floor(Math.random()*listeners.length)].status.push("poison"); break;
      case "item": items.push("ã‚¢ã‚¤ãƒ†ãƒ "); break;
    }
    pos++;
    setButtons([{text:"æ¬¡ã®ãƒã‚¹ã¸", cb:nextMove}]);
  }, 800);
}

// ---------------- åˆæœŸåŒ– ----------------
startGame();
updateParty();
</script>

</body>
</html>
